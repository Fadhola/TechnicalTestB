Dalam proses refactor ini, saya memecah struktur kode yang semula ada di `main.py` menjadi beberapa komponen terpisah berdasarkan tanggung jawabnya. Tujuannya adalah untuk membuat setiap bagian kode memiliki fungsi yang jelas. Saya membuat tiga komponen utama dan menyimpannya di folder `services`, yaitu `EmbeddingService`(di file terpisah `embedding.py`) yang bertanggung jawab untuk menghasilkan embedding dari teks, `DocumentStore`(di file terpisah `store.py`) yang mengelola penyimpanan dan pencarian dokumen dengan fallback otomatis ke in-memory list apabila Qdrant tidak tersedia, serta `RagWorkflow`(di file terpisah `rag.py`) yang mengatur alur kerja RAG (retrieval â†’ answer) menggunakan LangGraph. Sementara itu saya membuat file baru `api.py` digunakan untuk menampung logika FastAPI endpoint, dan `main.py` menjadi entry point aplikasi yang menginisialisasi FastAPI serta mendaftarkan router dan semua itu dibungkus di folder `app` supaya lebih rapi.

Salah satu trade-off dari pendekatan ini adalah meningkatnya jumlah file dan struktur yang tampak lebih kompleks dibandingkan versi awal. Namun, perubahan ini memberikan dampak positif terhadap keterbacaan dan maintainability secara keseluruhan. Dengan memisahkan logika aplikasi dan dependensinya secara eksplisit melalui _dependency injection_, setiap komponen kini dapat diuji dan dikembangkan secara independen tanpa harus menjalankan seluruh sistem. Versi refactor ini juga meningkatkan kualitas kode dengan menghilangkan penggunaan global state.
